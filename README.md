# SillyTavern Atable 提及插件
![alt text](figs/fig1.jpg)
![alt text](figs/fig2.jpg)

这是一个由 **肥鲇鱼** 为 [SillyTavern](https://github.com/SillyTavern/SillyTavern) 设计的扩展插件，旨在通过引入强大的 `@提及` 功能，显著提升多角色扮演（Roleplay）的互动体验和场景管理的便利性。

## ✨ 核心功能

- **💬 智能 `@提及` 补全**: 在输入框中输入 `@` 符号，即可激活一个跟随光标的浮动菜单，实时展示当前场景中所有可提及的角色列表。支持键盘选择和模糊搜索，轻松指定对话或动作的目标。

- **🎨 聊天内容高亮**: AI回复中的角色提及（例如由 `[at-tag name="角色名"]文本[/at-tag]` 格式生成的内容）会被自动渲染成醒目的高亮样式，一眼就能看出谁在对谁说话。

- **⚙️ 动态角色列表管理**: 插件能够智能解析AI回复中包含的特定标签（`[at-list]角色A,角色B[/at-list]`），并自动更新可 `@` 的角色列表。这意味着随着故事中角色的登场与退场，补全菜单中的名单也会实时变化。

- **🔧 高度可定制化**:
    - **总开关**: 一键启用或禁用插件所有功能。
    - **模板替换**: 可选功能，在发送消息时，自动将 `@角色名 内容` 的格式替换为你自定义的模板（例如 `[at-tag name="角色名"]内容[/at-tag]`），以更好地引导AI。
    - **提示词注入**: 自动在每次发送给AI的提示词中注入指令，引导模型返回插件所需的格式。你可以自由编辑和切换多套提示词模板。
    - **自定义样式**: 通过自定义CSS，完全掌控 `@提及` 在聊天记录中的显示外观。

## 🚀 如何使用

1.  **启用插件**:
    - 前往 `扩展` -> `插件设置` 页面。
    - 找到 `Feinianyu-Atable` 设置区域。
    - 勾选顶部的 **`启用`** 复选框。

2.  **使用 `@提及`**:
    - 在聊天输入框中，输入 `@` 符号。
    - 在弹出的列表中选择你想要提及的角色，或继续输入以筛选列表。
    - 按下回车或点击鼠标即可完成补全。

3.  **配置模板替换 (可选)**:
    - 在插件设置中，勾选 **`启用模板替换`**。
    - 在下方的模板区域，你可以编辑当你发送 `@角色名 内容` 时的转换格式。默认模板为 `[at-tag name="{{name}}"]{{content}}[/at-tag]`。

4.  **配置提示词注入 (推荐)**:
    - 在插件设置中，勾选 **`自动注入提示词`**。
    - 在提示词模板区域，选择或编辑一个模板。这个模板会作为系统指令，引导语言模型在其回复中正确地使用 `[at-list]` 和 `[at-tag]` 标签。一个好的提示词是插件所有功能正常工作的关键。

## 🤖 如何让语言模型更好地配合

为了让插件的动态角色列表和高亮功能生效，你的语言模型（LLM）需要在其回复中包含两种特定的BBCode格式标签：

1.  **场景角色名单 (`[at-list]`)**:
    - **用途**: 提供当前场景中所有可被 `@` 的角色的**完整名单**。
    - **格式**: `[at-list]角色A,角色B,角色C[/at-list]`
    - **位置**: 必须放置在回复内容的**最末尾**。
    - **效果**: 插件会解析这个列表，并用它来更新下一次 `@` 补全菜单的内容。这个标签本身不会显示给用户。

2.  **内联提及标签 (`[at-tag]`)**:
    - **用途**: 在对话或叙事文本中，标记出某个词语具体指向的角色。
    - **格式**: `[at-tag name="权威角色名"]实际显示的文本[/at-tag]`
    - **示例**: `[at-tag name="莉莉丝"]她[/at-tag]对[at-tag name="明日香"]你[/at-tag]说：“我们成功了。”`
    - **效果**: 插件会将其渲染为 `<span class="atable-highlight" data-character-name="莉莉丝">她</span>`，最终用户看到的是被高亮样式的“她”。

通过在你的角色卡、世界信息或自定义的提示词模板中加入对这两种格式的引导和示例，你可以让任何语言模型都与本插件完美协作。